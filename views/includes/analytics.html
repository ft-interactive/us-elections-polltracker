<script async>
(function () {
  function init() {
    var oTracking = Origami['o-tracking'];
    var page_data = {
      content: { asset_type: 'interactive' }
    };

    var properties = [].reduce.call(document.querySelectorAll('head meta[property^="ft.track:"]')||[], function(o, el) {
      o[el.getAttribute('property').replace('ft.track:', '')] = el.getAttribute('content');
      return o;
    }, {});

    var id = document.documentElement.getAttribute('data-content-id');

    if (id) {
      page_data.content.uuid = id;
    }

    if (properties.microsite_name) {
      page_data.microsite_name = properties.microsite_name;
    }

    oTracking.init({
      server: 'https://spoor-api.ft.com/px.gif',
      system: {
        is_live: typeof properties.is_live === 'string' ? properties.is_live.toLowerCase() : false
      },
      context: { product: properties.product || 'IG' }
    });

    // Automatic link tracking
    oTracking.link.init();
    // Register page view
    oTracking.page(page_data);
  }

  var o = document.createElement('script');
  o.async = o.defer = true;
  o.src = 'https://origami-build.ft.com/v2/bundles/js?modules=o-tracking';
  var s = document.getElementsByTagName('script')[0];
  if (o.hasOwnProperty('onreadystatechange')) {
    o.onreadystatechange = function() {
      if (o.readyState === 'loaded') {
        init();
      }
    };
  } else {
    o.onload = init;
  }
  s.parentNode.insertBefore(o, s);

}());

</script>

{% filter spoorTrackingPixel %}
{
    "action": "view",
    "category": "page",
    "context": {
        "content": {
            "asset_type": "interactive"
            {%if id %},"uuid": "{{ id }}"{% endif %}
        },
        "product": "IG",
        "microsite_name": "us-elections"
    },
    "system": {
        "is_live": {{ "true" if flags.prod else "false" }},
        "apiKey": "qUb9maKfKbtpRsdp0p2J7uWxRPGJEP",
        "source": "o-tracking-ns",
        "version": "1.0.0"
    }
}
{% endfilter %}
{% if flags.googleAnalytics %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-35229645-7', 'auto');
  ga('require','displayfeatures');
  ga('require', 'linkid');
  ga('send', 'pageview');
</script>
{% endif %}
