{% import "page-elements.html" as PageElements -%}

{% macro LineChart(statename, title, subtitle, svgs, latestPollAverages) %}
  {% if svgs.default != false %}
    {% call PageElements.Figure(title=title, subtitle=subtitle) %}
      {% for gridsize, svg in svgs %}
        {% if svg %}
        <div class="pollchart pollchart--{{gridsize}}">{{ svg | safe }}</div>
        {% endif %}
      {% endfor %}

      <p>Libertarian candidate <span style="border-bottom:3px solid #6e4794">Gary Johnson</span> is polling at <span style="font-weight: 600;">{{ latestPollAverages.Johnson }}</span> per cent. 

      {% if statename == 'Indiana' or statename == 'North Carolina' or statename == 'Georgia' %}
      Green Party candidate <span style="border-bottom:3px solid #55c72c">Jill Stein</span>, who is not on the ballot in {{ statename }} but can be written in, is polling at <span style="font-weight: 600;">{{ latestPollAverages.Stein }}</span> per cent.</p>
      {% else %}
      Green Party candidate <span style="border-bottom:3px solid #55c72c">Jill Stein</span> is{% if latestPollAverages.Stein %} polling at <span style="font-weight: 600;">{{ latestPollAverages.Stein }}</span> per cent{% else %} not on the ballot in {{ statename }}{% endif %}.</p>
      {% endif %}

    {% endcall %}
  {% endif %}
{% endmacro %}

{% macro Table(title, subtitle, list, startCollapse=20) %}
<div id="individualpolls">
  {% call PageElements.Figure(title=title, subtitle=subtitle) %}
    {% if list and list.length > 0 %}
      {% if list.length > startCollapse %}
      <div data-o-component="o-expander" class="o-expander items"
            data-o-expander-collapsed-toggle-text="Show more polls"
            data-o-expander-expanded-toggle-text="Show fewer polls"
            data-o-expander-toggle-selector=".table-toggle-btn"
            data-o-expander-shrink-to="{{ startCollapse }}"
            data-o-expander-count-selector="tbody tr">
      {% else %}
      <div class="items">
      {% endif %}
    <table>
      <thead>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Pollster</th>
          <th scope="col" class="numeric narrowonly">Clinton / Trump&nbsp;(%)</th>
          <th scope="col" class="numeric secondary">Clinton</th>
          <th scope="col" class="numeric secondary">Trump</th>
          <th scope="col" class="samplesize secondary">Sample*</th>
        </tr>
      </thead>
      <tbody class="o-expander__content">
        {% for poll in list %}
        <tr>
          <td class="date">{{ poll.date | formatDateForIndividualPollsTable }}</td>
          <td>{{ poll.pollster }}</td>
          <td class="narrowonly numeric {% if poll.winner == 'Clinton' %}winner clinton{% endif %} {% if poll.winner == 'Trump' %}winner trump{% endif %}"><span class="{% if poll.winner == 'Clinton' %}winner{% endif %}">{{ poll.Clinton }}</span> / <span class="{% if poll.winner == 'Trump' %}winner{% endif %}">{{ poll.Trump }}</span></td>
          <td class="secondary numeric clinton {% if poll.winner == 'Clinton' %}winner{% endif %}">{{ poll.Clinton }}%</td>
          <td class="secondary numeric trump {% if poll.winner == 'Trump' %}winner{% endif %}">{{ poll.Trump }}%</td>
          <td class="numeric samplesize secondary">{{ poll.sampleSize | commas | formatSampleSizeForIndividualPollsTable | safe }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <p class="note"><small>* RV indicates registered voters; LV indicates likely voters</small></p>
    {% if list.length > startCollapse %}
    <button class="table-toggle-btn o--if-js o-buttons o-buttons--uncolored o-buttons--big">Show more polls</button>
    {% endif %}
    </div>
    {% else %}
    <p class="notavailable">Polls for this state are not available yet.</p>
    {% endif %}
  {% endcall %}
</div>
{% endmacro %}
