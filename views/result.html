{% extends "g-ui/layout/article" %}

{% import "page-elements.html" as PageElements -%}
{% import "g-ui/ads" as Ads -%}

{% set layout = {name: 'full-body'} %}
{% set stylesheets = [
  'https://origami-build.ft.com/v2/bundles/css?modules=o-expander@^4.0.2,o-buttons@^4.0.2,o-grid@^4.2.1,o-cookie-message@^2.2.0',
  'g-ui/main.css',
  'main.css',
  'result-page.css',
  'result-bars.css'
  ]
%}
{% set scripts = [
  'result-page.js',
  'g-ui/index.js',
  'https://origami-build.ft.com/v2/bundles/js?export=bundle&modules=o-expander@^4.0.2,o-buttons@^4.0.2,o-date@^2.6.0,o-cookie-message@^2.2.0'
  ]
%}

{% block appendhead %}
<link rel="preload" href="result-page.js" as="script">
{% include "includes/common-preloads.html" %}
<script>
var pageDataTimestamp = {{ overview.timestamp }};
</script>
{% endblock -%}

{% block article_body %}
<div class="article__main">
  <div class="o-grid-container">
    <div class="o-grid-row">
      <div data-o-grid-colspan="center 12">
          {% import "includes/result-bar-macros.html" as bars %}
          <div>
            <div class="o-grid-row result-bars president-bars">
              {{ bars.president(
                  overview.president.isFinal,
                  overview.president.clinton,
                  overview.president.clinton_pct,
                  overview.president.trump,
                  overview.president.trump_pct,
                  overview.president.bestGuessClinton_pct,
                  overview.president.bestGuessTrump_pct,
                  "footnote") }}
            </div>
            <div class="o-grid-row article-figure">
              <div data-o-grid-colspan="center 12 L10">
                <div class="plain-map">
                    {% include "includes/results-plain-map.svg" %}
                    <div class="toss-up">
                      <div class="toss-up-legend"></div>
                      <div class="toss-up-label">Toss-up state</div>
                    </div>
                    <span class="map__footnote">Tom footnote to go here showing number of states</span>
                </div>
                <div class="dot-map">
                  <h2 class="article-figure__heading">Electoral college votes by state</h2>
                  <p class="article-figure__subheading">Each candidate needs 270 electoral college votes to win the presidency</p>
                  <div class="toss-up">
                    <div class="toss-up-legend"></div>
                    <div class="toss-up-label">Toss-up state</div>
                  </div>
                    {% include "includes/results-dot-map.svg" %}
                    <span class="map__footnote">Tom footnote to go here showing number of states</span>
                </div>
              </div>
          </div>
      </div>

      <div data-o-grid-colspan="center 12">
        {{ Ads.MidpageFullGrid(flags.ads) }}
      </div>

      <div data-o-grid-colspan="12 L6">
          {% call PageElements.Figure(title="What the US media is saying") %}
            {% for org in mediaOrgs %}
            <div>{{ org.name }} Clinton:{{org.totals.d}} Trump:{{org.totals.r}} ({{ org.totals.r + org.totals.d }}/ 538)</div>
            {% endfor %}
          {% endcall %}
      </div>
      <div data-o-grid-colspan="12 L6">
          <div class="house-bars">
            {% call PageElements.Figure(title="House", id="House") %}
                  {{ bars.house(
                    overview.house.dem_pct,
                    overview.house.dem,
                    overview.house.rep_pct,
                    overview.house.rep,
                    "footnote") }}
            {% endcall %}
          </div>
          <div class="senate-bars">
            {% call PageElements.Figure(title="Senate", id="Senate") %}
              {{ bars.senate(
                overview.senate.dem_pct,
                overview.senate.dem,
                overview.senate.rep_pct,
                overview.senate.rep,
                "footnote")
              }}
            {% endcall %}
          </div>
      </div>

      {% set showSuggestedReads = flags.onwardJourney and
                                  flags.resultSuggestedReads and
                                  onwardJourney.suggestedReads.data and
                                  onwardJourney.suggestedReads.data.items and
                                  onwardJourney.suggestedReads.data.items.length > 2 %}
      {% if showSuggestedReads %}
        </div>
      </div>
      <div class="o-grid-container o-grid-container--bleed">
        <div class="o-grid-row">
          <aside data-o-grid-colspan="center 12">
          {% set firstThreeSelectedReads = onwardJourney.suggestedReads.data.items.slice(0, 3) %}
          {{ PageElements.SuggestedReads(title="Top stories", items=firstThreeSelectedReads) }}
          </aside>
        </div>
      </div>
      <div class="o-grid-container">
        <div class="o-grid-row">
      {% endif %}

      <div data-o-grid-colspan="center 12 M9 L6">
          {% call PageElements.Figure(title="All states", id="all-states") %}
            <table class="ecresultslist">
              <thead>
                <tr>
                  <th class="ecresultslist__headercell">2012</th>
                  <th class="ecresultslist__headercell">2016</th>
                  <th class="ecresultslist__headercell">State</th>
                  <th class="ecresultslist__headercell">Votes</th>
                  <th class="ecresultslist__headercell--optional">Margin</th>
                </tr>
              </thead>
              <tbody>
                {% for state in stateResults %}
                <tr class="ecresultslist__row" id="{{ state.code }}-row">
                  <td class="ecresultslist__cell--2012 ecresultslist__cell--{{ state.code | winner2012 }}"></td>
                  <td class="ecresultslist__cell--2016 ecresultslist__cell--{% if state.winner == 'r' %}rep{% endif %}{% if state.winner == 'd' %}dem{% endif %}">{% if state.winner == 'r' %} Trump {% endif %} {% if state.winner == 'd' %}Clinton{% endif %}</td>
                  <td class="ecresultslist__cell--name ecresultslist__cell">{{ state.code | stateName }}</td>
                  <td class="ecresultslist__cell--ecvotes">{{ state.ecvotes }}</td>
                  <td class="ecresultslist__cell--margin"></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endcall %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
