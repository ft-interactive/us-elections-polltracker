{% extends "results-layout.html" %}

{% block content %}
<p>{{ subtitle }}</p>
<script src="d3.v4.min.js"></script>
<script>
    var timestamp = {{ overview.timestamp }};
</script>

{% import "includes/result-bar-macros.html" as bars %}

<div>
    {{ bars.president( 
        overview.president.isFinal, 
        overview.president.clinton, 
        overview.president.clinton_pct, 
        overview.president.trump, 
        overview.president.trump_pct, 
        overview.president.bestGuessClinton_pct, 
        overview.president.bestGuessTrump_pct, 
        "footnote") }}

    <div>
        {% include "includes/results-plain-map.svg" %}
    </div>
    <div>
        {% include "includes/results-538-cartogram.svg" %}
    </div>
    <div>
        {% include "includes/results-dot-map.svg" %}
    </div>
</div>
<div>
    What the US media is saying
    {% for org in mediaOrgs %}
    <div>{{ org.name }} Clinton:{{org.totals.d}} Trump:{{org.totals.r}} ({{ org.totals.r + org.totals.d }}/ 538)</div>
    {% endfor %}
</div>
<div>
    <h2>House</h2>
    <div>{{ bars.house(
        overview.house.dem_pct, 
        overview.house.dem, 
        overview.house.rep_pct, 
        overview.house.rep, 
        "footnote") }}</div>
</div>
<div>
    <h2>Senate</h2>
    <div><div>{{ bars.senate(
        overview.senate.dem_pct, 
        overview.senate.dem, 
        overview.senate.rep_pct, 
        overview.senate.rep, 
        "footnote") }}</div></div>
</div>
<div>
    <h2>Electoral college detail</h2>
    <table class="ecresultslist">
    <thead>
    <tr>
        <th class="ecresultslist__headercell">2012</th>
        <th class="ecresultslist__headercell">2016</th>
        <th class="ecresultslist__headercell">State</th>
        <th class="ecresultslist__headercell">Votes</th>
        <th class="ecresultslist__headercell--optional">Margin</th>
    </tr>
    </thead>
    <tbody>
    {% for state in stateResults %}
    <tr>
        <td class="ecresultslist__cell--{{ state.code | winner2012 }}"></td>
        <td class="ecresultslist__cell--{% if state.winner == 'r' %}rep{% endif %}{% if state.winner == 'd' %}dem{% endif %}">{% if state.winner == 'r' %} Trump {% endif %} {% if state.winner == 'd' %}Clinton{% endif %}</td>
        <td class="ecresultslist__cell">{{ state.code | stateName }}</td>
        <td class="ecresultslist__cell">{{ state.ecvotes }}</td>
        <td class="ecresultslist__cell"></td>
    </tr>
    {% endfor %}
    </tbody>
    </table>
</div>

<script>
//set polling frequency

function getData(){
    d3.json('full-result.json',function(d){
        if(d.overview.timestamp>timestamp){
            timestamp = d.overview.timestamp;
            console.log('ts');
        }
    });
}
</script>
{% endblock %}